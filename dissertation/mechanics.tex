\chapter{Proof of Lemma \ref{lem:substitution}}
\label{app:substitution}

\begin{proof}{Case \scheme|e = (rator-expr rand-expr)|}

\noindent
\scheme|Ccps[(rator-expr rand-expr)[x <- v]]|=\scheme|Ccps[(rator-expr[x <- v] rand-expr[x <- v])]|

\noindent
\scheme|Ccps[(rator-expr rand-expr)][x <- Cpcps[v]]|

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
   (lambda (flag)
     (lambda (marks)
       (((Ccps[rator-expr]
          (lambda (rator-value)
            (((Ccps[rand-expr]
               (lambda (rand-value)
                 ((((rator-value rand-value) kont) flag) marks)))
              FALSE) marks)))
         FALSE) marks))))[x <- Cpcps[v]]
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
   (lambda (flag)
     (lambda (marks)
       (((Ccps[rator-expr]
          (lambda (rator-value)
            (((Ccps[rand-expr]
               (lambda (rand-value)
                 ((((rator-value rand-value) kont) flag) marks)))
              FALSE) marks)))
         FALSE) marks))[x <- Cpcps[v]]))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
   (lambda (flag)
     (lambda (marks)
       (((Ccps[rator-expr]
          (lambda (rator-value)
            (((Ccps[rand-expr]
               (lambda (rand-value)
                 ((((rator-value rand-value) kont) flag) marks)))
              FALSE) marks)))
         FALSE) marks)[x <- Cpcps[v]])))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
   (lambda (flag)
     (lambda (marks)
       (((Ccps[rator-expr]
          (lambda (rator-value)
            (((Ccps[rand-expr]
               (lambda (rand-value)
                 ((((rator-value rand-value) kont) flag) marks)))
              FALSE) marks)))
         FALSE)[x <- Cpcps[v]] marks[x <- Cpcps[v]]))))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
   (lambda (flag)
     (lambda (marks)
       (((Ccps[rator-expr]
          (lambda (rator-value)
            (((Ccps[rand-expr]
               (lambda (rand-value)
                 ((((rator-value rand-value) kont) flag) marks)))
              FALSE) marks)))[x <- Cpcps[v]]
         FALSE[x <- Cpcps[v]]) marks))))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
   (lambda (flag)
     (lambda (marks)
       (((Ccps[rator-expr][x <- Cpcps[v]]
          (lambda (rator-value)
            (((Ccps[rand-expr]
               (lambda (rand-value)
                 ((((rator-value rand-value) kont) flag) marks)))
              FALSE) marks))[x <- Cpcps[v]])
         FALSE) marks))))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
   (lambda (flag)
     (lambda (marks)
       (((Ccps[rator-expr][x <- Cpcps[v]]
          (lambda (rator-value)
            (((Ccps[rand-expr]
               (lambda (rand-value)
                 ((((rator-value rand-value) kont) flag) marks)))
              FALSE) marks)[x <- Cpcps[v]]))
         FALSE) marks))))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
   (lambda (flag)
     (lambda (marks)
       (((Ccps[rator-expr][x <- Cpcps[v]]
          (lambda (rator-value)
            (((Ccps[rand-expr]
               (lambda (rand-value)
                 ((((rator-value rand-value) kont) flag) marks)))
              FALSE)[x <- Cpcps[v]] marks[x <- Cpcps[v]])))
         FALSE) marks))))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
   (lambda (flag)
     (lambda (marks)
       (((Ccps[rator-expr][x <- Cpcps[v]]
          (lambda (rator-value)
            (((Ccps[rand-expr]
               (lambda (rand-value)
                 ((((rator-value rand-value) kont) flag) marks)))[x <- Cpcps[v]]
              FALSE[x <- Cpcps[v]]) marks)))
         FALSE) marks))))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
   (lambda (flag)
     (lambda (marks)
       (((Ccps[rator-expr][x <- Cpcps[v]]
          (lambda (rator-value)
            (((Ccps[rand-expr][x <- Cpcps[v]]
               (lambda (rand-value)
                 ((((rator-value rand-value) kont) flag) marks))[x <- Cpcps[v]])
              FALSE) marks)))
         FALSE) marks))))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
   (lambda (flag)
     (lambda (marks)
       (((Ccps[rator-expr][x <- Cpcps[v]]
          (lambda (rator-value)
            (((Ccps[rand-expr][x <- Cpcps[v]]
               (lambda (rand-value)
                 ((((rator-value rand-value) kont) flag) marks)[x <- Cpcps[v]]))
              FALSE) marks)))
         FALSE) marks))))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
   (lambda (flag)
     (lambda (marks)
       (((Ccps[rator-expr][x <- Cpcps[v]]
          (lambda (rator-value)
            (((Ccps[rand-expr][x <- Cpcps[v]]
               (lambda (rand-value)
                 ((((rator-value rand-value) kont) flag)[x <- Cpcps[v]] marks[x <- Cpcps[v]])))
              FALSE) marks)))
         FALSE) marks))))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
   (lambda (flag)
     (lambda (marks)
       (((Ccps[rator-expr][x <- Cpcps[v]]
          (lambda (rator-value)
            (((Ccps[rand-expr][x <- Cpcps[v]]
               (lambda (rand-value)
                 ((((rator-value rand-value) kont)[x <- Cpcps[v]] flag[x <- Cpcps[v]]) marks)))
              FALSE) marks)))
         FALSE) marks))))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
   (lambda (flag)
     (lambda (marks)
       (((Ccps[rator-expr][x <- Cpcps[v]]
          (lambda (rator-value)
            (((Ccps[rand-expr][x <- Cpcps[v]]
               (lambda (rand-value)
                 ((((rator-value rand-value)[x <- Cpcps[v]] kont[x <- Cpcps[v]]) flag) marks)))
              FALSE) marks)))
         FALSE) marks))))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
   (lambda (flag)
     (lambda (marks)
       (((Ccps[rator-expr][x <- Cpcps[v]]
          (lambda (rator-value)
            (((Ccps[rand-expr][x <- Cpcps[v]]
               (lambda (rand-value)
                 ((((rator-value[x <- Cpcps[v]] rand-value[x <- Cpcps[v]]) kont) flag) marks)))
              FALSE) marks)))
         FALSE) marks))))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
   (lambda (flag)
     (lambda (marks)
       (((Ccps[rator-expr][x <- Cpcps[v]]
          (lambda (rator-value)
            (((Ccps[rand-expr][x <- Cpcps[v]]
               (lambda (rand-value)
                 ((((rator-value rand-value) kont) flag) marks)))
              FALSE) marks)))
         FALSE) marks))))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
   (lambda (flag)
     (lambda (marks)
       (((Ccps[rator-expr[x <- v]]
          (lambda (rator-value)
            (((Ccps[rand-expr[x <- v]]
               (lambda (rand-value)
                 ((((rator-value rand-value) kont) flag) marks)))
              FALSE) marks)))
         FALSE) marks))))
\end{schemedisplay}
\end{schemeblock}

\noindent
\scheme|Ccps[(rator-expr[x <- v] rand-expr[x <- v])]|

\noindent
Therefore, \scheme|Ccps[(rator-expr rand-expr)[x <- v]] = Ccps[(rator-expr rand-expr)][x <- Cpcps[v]]|.
\end{proof}

\begin{proof}{Case \scheme|e = (wcm mark-expr body-expr)|}

\noindent
\scheme|Ccps[(wcm mark-expr body-expr)[x <- v]] = Ccps[(wcm mark-expr[x <- v] body-expr[x <- v])]|

\noindent
\scheme|Ccps[(wcm mark-expr body-expr)][x <- Cpcps[v]]|

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (((Ccps[mark-expr]
          (lambda (mark-value) 
            ((lambda (rest-marks) 
               (((Ccps[body-expr] kont) TRUE) Chcps[((CONS mark-value) rest-marks)]))
             ((flag Chcps[(SND marks)]) marks))))
        FALSE) marks))))[x <- Cpcps[v]]
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (((Ccps[mark-expr]
          (lambda (mark-value) 
            ((lambda (rest-marks) 
               (((Ccps[body-expr] kont) TRUE) Chcps[((CONS mark-value) rest-marks)]))
             ((flag Chcps[(SND marks)]) marks))))
        FALSE) marks)))[x <- Cpcps[v]])
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (((Ccps[mark-expr]
          (lambda (mark-value) 
            ((lambda (rest-marks) 
               (((Ccps[body-expr] kont) TRUE) Chcps[((CONS mark-value) rest-marks)]))
             ((flag Chcps[(SND marks)]) marks))))
        FALSE) marks))[x <- Cpcps[v]]))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (((Ccps[mark-expr]
          (lambda (mark-value) 
            ((lambda (rest-marks) 
               (((Ccps[body-expr] kont) TRUE) Chcps[((CONS mark-value) rest-marks)]))
             ((flag Chcps[(SND marks)]) marks))))
        FALSE) marks)[x <- Cpcps[v]])))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (((Ccps[mark-expr]
          (lambda (mark-value) 
            ((lambda (rest-marks) 
               (((Ccps[body-expr] kont) TRUE) Chcps[((CONS mark-value) rest-marks)]))
             ((flag Chcps[(SND marks)]) marks))))
        FALSE)[x <- Cpcps[v]] marks[x <- Cpcps[v]]))))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (((Ccps[mark-expr]
          (lambda (mark-value) 
            ((lambda (rest-marks) 
               (((Ccps[body-expr] kont) TRUE) Chcps[((CONS mark-value) rest-marks)]))
             ((flag Chcps[(SND marks)]) marks))))[x <- Cpcps[v]]
        FALSE[x <- Cpcps[v]]) marks))))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (((Ccps[mark-expr][x <- Cpcps[v]]
          (lambda (mark-value) 
            ((lambda (rest-marks) 
               (((Ccps[body-expr] kont) TRUE) Chcps[((CONS mark-value) rest-marks)]))
             ((flag Chcps[(SND marks)]) marks)))[x <- Cpcps[v]])
        FALSE) marks))))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (((Ccps[mark-expr][x <- Cpcps[v]]
          (lambda (mark-value) 
            ((lambda (rest-marks) 
               (((Ccps[body-expr] kont) TRUE) Chcps[((CONS mark-value) rest-marks)]))
             ((flag Chcps[(SND marks)]) marks))[x <- Cpcps[v]]))
        FALSE) marks))))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (((Ccps[mark-expr][x <- Cpcps[v]]
          (lambda (mark-value) 
            ((lambda (rest-marks) 
               (((Ccps[body-expr] kont) TRUE) Chcps[((CONS mark-value) rest-marks)]))[x <- Cpcps[v]]
             ((flag Chcps[(SND marks)]) marks)[x <- Cpcps[v]])))
        FALSE) marks))))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (((Ccps[mark-expr][x <- Cpcps[v]]
          (lambda (mark-value) 
            ((lambda (rest-marks) 
               (((Ccps[body-expr] kont) TRUE) Chcps[((CONS mark-value) rest-marks)])[x <- Cpcps[v]])
             ((flag Chcps[(SND marks)])[x <- Cpcps[v]] marks[x <- Cpcps[v]]))))
        FALSE) marks))))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (((Ccps[mark-expr][x <- Cpcps[v]]
          (lambda (mark-value) 
            ((lambda (rest-marks) 
               (((Ccps[body-expr] kont) TRUE)[x <- Cpcps[v]] Chcps[((CONS mark-value) rest-marks)][x <- Cpcps[v]]))
             ((flag[x <- Cpcps[v]] Chcps[(SND marks)][x <- Cpcps[v]]) marks))))
        FALSE) marks))))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (((Ccps[mark-expr][x <- Cpcps[v]]
          (lambda (mark-value) 
            ((lambda (rest-marks) 
               (((Ccps[body-expr] kont)[x <- Cpcps[v]] TRUE[x <- Cpcps[v]]) Chcps[((CONS mark-value) rest-marks)]))
             ((flag Chcps[(SND marks)]) marks))))
        FALSE) marks))))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (((Ccps[mark-expr][x <- Cpcps[v]]
          (lambda (mark-value) 
            ((lambda (rest-marks) 
               (((Ccps[body-expr][x <- Cpcps[v]] kont[x <- Cpcps[v]]) TRUE) Chcps[((CONS mark-value) rest-marks)]))
             ((flag Chcps[(SND marks)]) marks))))
        FALSE) marks))))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (((Ccps[mark-expr][x <- Cpcps[v]]
          (lambda (mark-value) 
            ((lambda (rest-marks) 
               (((Ccps[body-expr][x <- Cpcps[v]] kont) TRUE) Chcps[((CONS mark-value) rest-marks)]))
             ((flag Chcps[(SND marks)]) marks))))
        FALSE) marks))))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (((Ccps[mark-expr[x <- v]]
          (lambda (mark-value) 
            ((lambda (rest-marks) 
               (((Ccps[body-expr[x <- v]] kont) TRUE) Chcps[((CONS mark-value) rest-marks)]))
             ((flag Chcps[(SND marks)]) marks))))
        FALSE) marks))))
\end{schemedisplay}
\end{schemeblock}

\noindent
\scheme|Ccps[(wcm mark-expr[x <- v] body-expr[x <- v])]|

\noindent
Therefore, \scheme|Ccps[(wcm mark-expr body-expr)[x <- v]] = Ccps[(wcm mark-expr body-expr)][x <- Cpcps[v]]|.
\end{proof}

\begin{proof}{Case \scheme'e'=\scheme|(ccm)|}

\scheme|Ccps[(ccm)[x <- v]]|=\scheme|Ccps[(ccm)]|

\scheme|Ccps[(ccm)][x <- Cpcps[v]]|

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (kont marks))))[x <- Cpcps[v]]
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (kont marks)))[x <- Cpcps[v]])
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (kont marks))[x <- Cpcps[v]]))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (kont marks)[x <- Cpcps[v]])))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (kont[x <- Cpcps[v]] marks[x <- Cpcps[v]]))))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (kont marks))))
\end{schemedisplay}
\end{schemeblock}

\noindent
\scheme|Ccps[(ccm)]|

Therefore \scheme|Ccps[(ccm)[x <- v]]=Ccps[(ccm)][x <- Cpcps[v]]|.
\end{proof}

\begin{proof}{Case \scheme|e = (lambda (x) ep)|}

\noindent
\scheme|Ccps[(lambda (x) ep)[x <- v]] = Ccps[(lambda (x) ep)]|

\noindent
\scheme|Ccps[(lambda (x) ep)][x <- Cpcps[v]]|

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (kont (lambda (x) Ccps[ep])))))[x <- Cpcps[v]]
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (kont (lambda (x) Ccps[ep]))))[x <- Cpcps[v]])
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (kont (lambda (x) Ccps[ep])))[x <- Cpcps[v]]))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (kont (lambda (x) Ccps[ep]))[x <- Cpcps[v]])))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (kont[x <- Cpcps[v]] (lambda (x) Ccps[ep])[x <- Cpcps[v]]))))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (kont (lambda (x) Ccps[ep])))))
\end{schemedisplay}
\end{schemeblock}

\noindent
\scheme|Ccps[(lambda (x) ep)]|

Therefore, \scheme|Ccps[(lambda (x) ep)[x <- v]] = Ccps[(lambda (x) ep)][x <- Cpcps[v]]|.
\end{proof}

\begin{proof}{Case \scheme|e = (lambda (xp) ep)| where $x'\ne x$}

\noindent
\scheme|Ccps[(lambda (xp) ep)[x <- v]] = Ccps[(lambda (x) ep[x <- v])]|

\noindent
\scheme|Ccps[(lambda (xp) ep)][x <- Cpcps[v]]|

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (kont (lambda (xp) Ccps[ep])))))[x <- Cpcps[v]]
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (kont (lambda (xp) Ccps[ep]))))[x <- Cpcps[v]])
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (kont (lambda (xp) Ccps[ep])))[x <- Cpcps[v]]))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (kont (lambda (xp) Ccps[ep]))[x <- Cpcps[v]])))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (kont[x <- Cpcps[v]] (lambda (xp) Ccps[ep])[x <- Cpcps[v]]))))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (kont (lambda (xp) Ccps[ep][x <- Cpcps[v]])))))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (kont (lambda (xp) Ccps[ep[x <- v]])))))
\end{schemedisplay}
\end{schemeblock}

\noindent
\scheme|Ccps[(lamba (xp) ep[x <- v])]|

Therefore, \scheme|Ccps[(lamba (xp) ep)[x <- v]] = Ccps[(lamba (xp) ep)][x <- Cpcps[v]]|.
\end{proof}

\begin{proof}{Case \scheme|e = x|}

\noindent
\scheme|Ccps[x[x <- v]] = Ccps[v]|

\noindent
\scheme|Ccps[x][x <- Cpcps[v]]|

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (kont x))))[x <- Cpcps[v]]
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (kont x)))[x <- Cpcps[v]])
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (kont x))[x <- Cpcps[v]]))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (kont x)[x <- Cpcps[v]])))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (kont[x <- Cpcps[v]] x[x <- Cpcps[v]]))))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (kont Cpcps[v]))))
\end{schemedisplay}
\end{schemeblock}

\noindent
\scheme|Ccps[v]|

Therefore, \scheme|Ccps[x[x <- v]] = Ccps[x][x <- Cpcps[v]]|.
\end{proof}

\begin{proof}{Case \scheme|e = xp| where $x'\ne x$}

\scheme|Ccps[xp[x <- v]]|=\scheme|Ccps[xp]|

\scheme|Ccps[xp][x <- Cpcps[v]]|

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (kont xp))))[x <- Cpcps[v]]
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (kont xp)))[x <- Cpcps[v]])
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (kont xp))[x <- Cpcps[v]]))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (kont xp)[x <- Cpcps[v]])))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (kont[x <- Cpcps[v]] xp[x <- Cpcps[v]]))))
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
(lambda (kont)
  (lambda (flag)
    (lambda (marks)
      (kont xp))))
\end{schemedisplay}
\end{schemeblock}

\noindent
\scheme|Ccps[xp]|

Therefore, \scheme|Ccps[xp[x <- v]] = Ccps[xp][x <- Cpcps[v]|.
\end{proof}

\chapter{Mechanical Proof}

\section{application form}

\noindent
\scheme|Ccps[E[(rator-expr rand-expr)]]|
\begin{schemeblock}
\begin{schemedisplay}
((((lambda (kont)
     (lambda (flag)
       (lambda (marks)
         (((Ccps[rator-expr]
                (lambda (rator-value)
                  (((Ccps[rand-expr]
                         (lambda (rand-value)
                           ((((rator-value rand-value) kont) flag) marks)))
                    FALSE) marks)))
           FALSE) marks))))
   CE) xiE) Cpcps[chiE])
\end{schemedisplay}
\end{schemeblock}

\noindent
app1

\begin{schemeblock}
\begin{schemedisplay}
(((lambda (flag)
    (lambda (marks)
      (((Ccps[rator-expr]
             (lambda (rator-value)
               (((Ccps[rand-expr]
                      (lambda (rand-value)
                        ((((rator-value rand-value) CE) flag) marks)))
                 FALSE) marks)))
        FALSE) marks)))
  xiE) Cpcps[chiE])
\end{schemedisplay}
\end{schemeblock}

\noindent
app2

\begin{schemeblock}
\begin{schemedisplay}
((lambda (marks)
   (((Ccps[rator-expr]
          (lambda (rator-value)
            (((Ccps[rand-expr]
                   (lambda (rand-value)
                     ((((rator-value rand-value) CE) xiE) marks)))
              FALSE) marks)))
     FALSE) marks)) Cpcps[chiE])
\end{schemedisplay}
\end{schemeblock}

\noindent
app3

\begin{schemeblock}
\begin{schemedisplay}
(((Ccps[rator-expr]
       (lambda (rator-value)
         (((Ccps[rand-expr]
                (lambda (rand-value)
                  ((((rator-value rand-value) CE) xiE) Cpcps[chiE])))
           FALSE) Cpcps[chiE])))
  FALSE) Cpcps[chiE])
\end{schemedisplay}
\end{schemeblock}

\noindent
app4

\begin{schemeblock}
\begin{schemedisplay}
(((Ccps[rand-expr]
       (lambda (rand-value)
         ((((Cpcps[v_0] rand-value) CE) xiE) Cpcps[chiE])))
  FALSE) Cpcps[chiE])
\end{schemedisplay}
\end{schemeblock}

\noindent
app5

\begin{schemeblock}
\begin{schemedisplay}
((((Cpcps[v_0] Cpcps[v_1]) CE) xiE) Cpcps[chiE])
\end{schemedisplay}
\end{schemeblock}

\begin{schemeblock}
\begin{schemedisplay}
((((Cpcps[(lambda (x) e_0)] Cpcps[v_1]) CE) xiE) Cpcps[chiE])
\end{schemedisplay}
\end{schemeblock}


\noindent
app6

\begin{schemeblock}
\begin{schemedisplay}
(((Ccps[e_0][x <- Cpcps[v_1]] CE) xiE) Cpcps[chiE])
\end{schemedisplay}
\end{schemeblock}

\section{wcm form}

\noindent
\scheme|Ccps[E[(wcm mark-expr body-expr)]]|
\begin{schemeblock}
\begin{schemedisplay}
((((lambda (kont)
     (lambda (flag)
       (lambda (marks)
         (((Ccps[mark-expr]
                (lambda (mark-value) 
                  ((lambda (rest-marks) 
                     (((Ccps[body-expr] kont) TRUE) Cpcps[((CONS mark-value) rest-marks)]))
                   ((flag Chcps[(SND marks)]) marks))))
           FALSE) marks))))
   CE) xiE) Cpcps[chiE])
\end{schemedisplay}
\end{schemeblock}

\noindent
wcm1

\begin{schemeblock}
\begin{schemedisplay}
(((lambda (flag)
    (lambda (marks)
      (((Ccps[mark-expr]
             (lambda (mark-value) 
               ((lambda (rest-marks) 
                  (((Ccps[body-expr] CE) TRUE) Cpcps[((CONS mark-value) rest-marks)]))
                ((flag Chcps[(SND marks)]) marks))))
        FALSE) marks)))
  xiE) Cpcps[chiE])
\end{schemedisplay}
\end{schemeblock}

\noindent
wcm2

\begin{schemeblock}
\begin{schemedisplay}
((lambda (marks)
   (((Ccps[mark-expr]
          (lambda (mark-value) 
            ((lambda (rest-marks) 
               (((Ccps[body-expr] CE) TRUE) Cpcps[((CONS mark-value) rest-marks)]))
             ((xiE Chcps[(SND marks)]) marks))))
     FALSE) marks))
 Cpcps[chiE])
\end{schemedisplay}
\end{schemeblock}

\noindent
wcm3

\begin{schemeblock}
\begin{schemedisplay}
(((Ccps[mark-expr]
       (lambda (mark-value) 
         ((lambda (rest-marks) 
            (((Ccps[body-expr] CE) TRUE) Cpcps[((CONS mark-value) rest-marks)]))
          ((xiE Chcps[(SND Cpcps[chiE])]) Cpcps[chiE]))))
  FALSE) Cpcps[chiE])
\end{schemedisplay}
\end{schemeblock}

\noindent
wcm4tail

\begin{schemeblock}
\begin{schemedisplay}
((lambda (rest-marks) 
   (((Ccps[body-expr] CE) TRUE) Cpcps[((CONS mark-value) rest-marks)]))
 ((TRUE Chcps[(SND Cpcps[chiE])]) Cpcps[chiE]))
\end{schemedisplay}
\end{schemeblock}

\noindent
wcm5tail

\begin{schemeblock}
\begin{schemedisplay}
((lambda (rest-marks) 
   (((Ccps[body-expr] CE) TRUE) Cpcps[((CONS mark-value) rest-marks)]))
 Cpcps[(SND Cpcps[chiE])])
\end{schemedisplay}
\end{schemeblock}

\noindent
wcm6tail

\begin{schemeblock}
\begin{schemedisplay}
(((Ccps[body-expr] CE) TRUE) Cpcps[((CONS mark-value) (SND chiE))])
\end{schemedisplay}
\end{schemeblock}

\noindent
wcm4nontail

\begin{schemeblock}
\begin{schemedisplay}
((lambda (rest-marks) 
   (((Ccps[body-expr] CE) TRUE) Cpcps[((CONS mark-value) rest-marks)]))
 ((FALSE Chcps[(SND Cpcps[chiE])]) Cpcps[chiE]))
\end{schemedisplay}
\end{schemeblock}

\noindent
wcm5nontail

\begin{schemeblock}
\begin{schemedisplay}
((lambda (rest-marks) 
   (((Ccps[body-expr] CE) TRUE) Cpcps[((CONS mark-value) rest-marks)]))
 Cpcps[chiE])
\end{schemedisplay}
\end{schemeblock}

\noindent
wcm6nontail

\begin{schemeblock}
\begin{schemedisplay}
(((Ccps[body-expr] CE) TRUE) Cpcps[((CONS mark-value) chiE)])
\end{schemedisplay}
\end{schemeblock}

\section{ccm form}

\noindent
\scheme|Ccps[E[(ccm)]]|
\begin{schemeblock}
\begin{schemedisplay}
((((lambda (kont)
     (lambda (flag)
       (lambda (marks)
         (kont marks))))
   CE) xiE) Cpcps[chiE])
\end{schemedisplay}
\end{schemeblock}

\noindent
ccm1

\begin{schemeblock}
\begin{schemedisplay}
(((lambda (flag)
    (lambda (marks)
      (CE marks)))
  xiE) Cpcps[chiE])
\end{schemedisplay}
\end{schemeblock}

\noindent
ccm2

\begin{schemeblock}
\begin{schemedisplay}
((lambda (marks)
   (CE marks))
 Cpcps[chiE])
\end{schemedisplay}
\end{schemeblock}

\noindent
ccm3

\begin{schemeblock}
\begin{schemedisplay}
(CE Cpcps[chiE])
\end{schemedisplay}
\end{schemeblock}

\section{value form}

\noindent
\scheme|Ccps[E[v]]|=\scheme|Ccps[E[(lambda (x) e)]]|

\begin{schemeblock}
\begin{schemedisplay}
((((lambda (kont)
     (lambda (flag)
       (lambda (marks)
         (kont (lambda (x) Ccps[e])))))
   CE) xiE) Cpcps[chiE])
\end{schemedisplay}
\end{schemeblock}

\noindent
value1

\begin{schemeblock}
\begin{schemedisplay}
(((lambda (flag)
    (lambda (marks)
      (CE (lambda (x) Ccps[e]))))
  xiE) Cpcps[chiE])
\end{schemedisplay}
\end{schemeblock}

\noindent
value2

\begin{schemeblock}
\begin{schemedisplay}
((lambda (marks)
   (CE (lambda (x) Ccps[e])))
 Cpcps[chiE])
\end{schemedisplay}
\end{schemeblock}

\noindent
value3

\begin{schemeblock}
\begin{schemedisplay}
(CE (lambda (x) Ccps[e]))
\end{schemedisplay}
\end{schemeblock}

\section{variable form}

\noindent
\scheme|Ccps[E[x]]|
\begin{schemeblock}
\begin{schemedisplay}
((((lambda (kont)
     (lambda (flag)
       (lambda (marks)
         (kont x))))
   CE) xiE) Cpcps[chiE])
\end{schemedisplay}
\end{schemeblock}

\noindent
x1

\begin{schemeblock}
\begin{schemedisplay}
(((lambda (flag)
    (lambda (marks)
      (CE x)))
  xiE) Cpcps[chiE])
\end{schemedisplay}
\end{schemeblock}

\noindent
x2

\begin{schemeblock}
\begin{schemedisplay}
((lambda (marks)
   (CE x))
 Cpcps[chiE])
\end{schemedisplay}
\end{schemeblock}

\noindent
x3

\begin{schemeblock}
\begin{schemedisplay}
(CE x)
\end{schemedisplay}
\end{schemeblock}

\noindent
x4

\begin{schemeblock}
\begin{schemedisplay}
(CE error)
\end{schemedisplay}
\end{schemeblock}

\noindent
x5

\begin{schemeblock}
\begin{schemedisplay}
error
\end{schemedisplay}
\end{schemeblock}

